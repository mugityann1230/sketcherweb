# sketcherweb 要件定義（正本）

## 0. 目的（1文）
ブラウザ上で2D形状を作成し、メッシュを生成して、有限要素法（FEM）ソルバに入力できる形式で出力する。

---

## 1. 想定ユーザー / 利用シーン
- 2Dの簡易形状（板、穴あき板、ブラケット等）を素早く作って解析したい
- 自作FEMまたは既存ソルバに渡すためのメッシュを作りたい
- CADの重装備ではなく、軽量なスケッチ＋メッシュ生成が欲しい

---

## 2. 用語
- Sketch：編集用の図形集合（点・線分・円弧など）
- Loop：閉じた輪郭（外周/内周）
- Region：解析用の面（外周1つ＋穴の内周0..n）
- Mesh：Regionから生成された要素分割（2D三角形を基本）

---

## 3. スコープ（作るもの）
### 3.1 最小構成（最初に動く到達点）
- 2Dスケッチ（線分/円/円弧）作成・編集
- 閉曲線から Region（外周＋穴）生成
- バックエンドでGmshによりメッシュ生成
- 出力：Gmsh `.msh`（v4固定）

### 3.2 次に増やす（後続）
- 境界のタグ付け（固定端、荷重面など）
- FEM入力ファイル生成（最小で1ソルバ）
- 寸法拘束（軽いものから）

---

## 4. 機能要件（Must / Should / Later）

### 4.1 作図/編集（Must）
- 表示/操作：パン、ズーム、グリッド表示
- スナップ：グリッド、端点、中点
- 図形：線分(Line)、円(Circle)、円弧(Arc)
- 編集：選択、移動、削除
- Undo/Redo
- 保存/読み込み：SketchをJSONで保存・復元

### 4.2 Region生成（Must）
- Sketchのエッジ集合から閉ループ抽出（Line/Arc混在）
- 外周/内周（穴）判定
- 妥当性チェック（少なくとも以下は弾く）
  - 未閉ループ
  - 自己交差（MVPは厳しめでOK）
  - 重複辺/極小辺（eps以下）

### 4.3 メッシュ生成（Must）
- Region→Gmsh入力に変換し、2Dメッシュ生成
- メッシュサイズ指定：global size（1つ）
- 生成結果を `.msh`（v4）でダウンロード

### 4.4 エラー表示（Must）
- 「メッシュ生成できない」ではなく理由を出す
  - 例：未閉、自己交差、穴が外周の外、など

### 4.5 境界条件のためのタグ（Should）
- 辺（境界）へのタグ付け
- タグ情報をGmsh Physical Group等で出力（方式はarchitectureで定義）

### 4.6 FEM入力生成（Later）
- `.msh` + タグ + 材料/荷重/拘束 から、最小1ソルバの入力ファイルを生成

### 4.7 寸法拘束（Later）
- まずは軽い拘束（水平/垂直/一致/長さ/半径）

---

## 5. 受け入れ条件（Acceptance）
### 例題A：穴あき板
- 外周：矩形、内周：円穴
- Regionとして成立し、`.msh` が生成できる

### 例題B：ドーナツ
- 外周：円、内周：円
- Regionとして成立し、`.msh` が生成できる

### 例題C：不正形状の検出
- 未閉曲線・自己交差はメッシュ生成前に明確にエラーが出る

---

## 6. 非目標（やらないこと）
- 3D、押し出し、ソリッド
- DXF/DWGの完全互換
- スプライン/自由曲線（当面）
- 製図機能（寸法線、注記、図枠、公差など）
- 高度な拘束ソルバ（当面）

---

## 7. 非機能要件
- 基本操作（パン/ズーム/選択/移動）は体感で遅くない（目標：100ms以内）
- 仕様変更が入る前提で、Sketch/Regionのデータ構造はバージョンを持つ
- 幾何ロジック（loop/region）は自動テストで守る

---

## 8. 成果物（出力）
- `Sketch(JSON)`：保存/復元用
- `Region(JSON)`：メッシュ生成APIの入力
- `Mesh(.msh v4)`：Gmshメッシュ出力（当面これが主）
